"use strict";(self.webpackChunkbjj_app=self.webpackChunkbjj_app||[]).push([[119],{119:(G,g,o)=>{o.r(g),o.d(g,{ScheduleModule:()=>L});var u=o(6814),r=o(6223),h=o(4581),_=o(8525),v=o(2032),T=o(5986),Z=o(9157),x=o(324),e=o(5879),f=o(6769),S=o(3076);const y=function(t,c){return{matA:t,matB:c}};function A(t,c){if(1&t&&(e.TgZ(0,"li",22)(1,"h3"),e._uU(2),e.qZA(),e.TgZ(3,"div",23),e._UZ(4,"i",24),e.TgZ(5,"div")(6,"h2"),e._uU(7),e.qZA()()(),e.TgZ(8,"div",25)(9,"p"),e._uU(10),e.qZA(),e.TgZ(11,"p"),e._uU(12),e.qZA()()()),2&t){const s=c.$implicit;e.Q6J("ngClass",e.WLB(6,y,"A"===s.class.mat,"B"===s.class.mat)),e.xp6(2),e.Oqu(s.class.name),e.xp6(5),e.AsE("",s.class.start," - ",s.class.end,""),e.xp6(3),e.hij("Mat: ",s.class.mat,""),e.xp6(2),e.hij("Prof: ",s.class.professor,"")}}function U(t,c){if(1&t&&(e.TgZ(0,"ul",20),e.YNc(1,A,13,9,"li",21),e.qZA()),2&t){const s=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",s.classes)}}const M=function(t){return[t]};function N(t,c){if(1&t&&(e.TgZ(0,"li",15)(1,"h2",16),e._uU(2),e.qZA(),e.YNc(3,U,2,1,"ul",17),e.TgZ(4,"button",18),e._UZ(5,"i",19),e.qZA()()),2&t){const s=c.$implicit,a=e.oxw(2);e.xp6(2),e.Oqu(s.dayName),e.xp6(1),e.Q6J("ngIf",s.classes),e.xp6(1),e.Q6J("routerLink",e.VKq(3,M,"/admin/dashboard/main-schedule/up-schedule/"+a.formatDayForUrl(s.day)))}}function O(t,c){if(1&t&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&t){const s=c.$implicit;e.xp6(1),e.hij("- ",s,"")}}function w(t,c){if(1&t&&(e.TgZ(0,"div",26)(1,"h3"),e._uU(2),e.qZA(),e.TgZ(3,"p"),e._uU(4,"Classes:"),e.qZA(),e.TgZ(5,"ul"),e.YNc(6,O,2,1,"li",27),e.qZA(),e.TgZ(7,"p"),e._uU(8),e.qZA(),e.TgZ(9,"p"),e._uU(10),e.qZA(),e.TgZ(11,"p"),e._uU(12),e.qZA(),e.TgZ(13,"p"),e._uU(14),e.qZA()()),2&t){const s=e.oxw(2);e.xp6(2),e.hij("Professor/coach: ",s.coachInfo.fullName,""),e.xp6(4),e.Q6J("ngForOf",s.coachInfo.classesNames),e.xp6(2),e.hij("Days: ",s.coachInfo.days,""),e.xp6(2),e.hij("Total number of Classes: ",s.coachInfo.totalClasses," Classes"),e.xp6(2),e.hij("Total classes time: ",s.coachInfo.totalTimeWorking," mins."),e.xp6(2),e.hij("Payment: $",s.coachInfo.totalEarnings,"")}}function F(t,c){if(1&t&&(e.TgZ(0,"option",28),e._uU(1),e.qZA()),2&t){const s=c.$implicit;e.Q6J("value",s.name),e.xp6(1),e.Oqu(s.fullName)}}function D(t,c){if(1&t){const s=e.EpF();e.TgZ(0,"div",6)(1,"ul",7),e.YNc(2,N,6,5,"li",8),e.qZA(),e.YNc(3,w,15,6,"div",9),e.TgZ(4,"div",10)(5,"select",11),e.NdJ("ngModelChange",function(n){e.CHM(s);const l=e.oxw();return e.KtG(l.selectedCoachName=n)}),e.TgZ(6,"option",12),e._uU(7,"All coaches' classes"),e.qZA(),e.YNc(8,F,2,2,"option",13),e.qZA(),e.TgZ(9,"button",14),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onFilterByCoach())}),e._uU(10,"Filter"),e.qZA()()()}if(2&t){const s=e.oxw();e.xp6(2),e.Q6J("ngForOf",s.weekSchedule.days),e.xp6(1),e.Q6J("ngIf",s.coachInfo),e.xp6(2),e.Q6J("ngModel",s.selectedCoachName),e.xp6(3),e.Q6J("ngForOf",s.coaches)}}let b=(()=>{class t{constructor(s,a){this.scheduleService=s,this.userService=a,this.selectedCoachName="",this.coachInfo=null}ngOnInit(){this.loadWeekSchedule(),this.loadCoaches()}loadWeekSchedule(){this.scheduleService.getWeekSchedule().subscribe(s=>{this.weekSchedule=this.sortClasses(s)},s=>{console.error("Error loading week schedule",s)})}loadCoaches(){this.userService.getusers().subscribe(s=>{this.coaches=s.filter(a=>"COACH"===a.type||"HEAD-PROFESSOR"===a.type||"PROFESSOR"===a.type||"ASSISTANT"===a.type).map(a=>({fullName:`${a.name} ${a.lastName}`,name:a.name,classPay:a.classPay,assignedClasses:0,totalEarnings:0}))})}formatDayForUrl(s){return new Date(s).toISOString().split("T")[0]}onFilterByCoach(){if(!this.selectedCoachName)return this.loadWeekSchedule(),void(this.coachInfo=null);this.scheduleService.getWeekSchedule().subscribe(s=>{this.weekSchedule=this.sortClasses(s,this.selectedCoachName),this.calculateCoachInfo(this.selectedCoachName)},s=>{console.error("Error loading week schedule",s)})}calculateCoachInfo(s){const a=this.coaches.find(n=>n.name===s);if(a){let n=0,l=0;const i=new Set,d=new Set;let m=0;this.weekSchedule.days.forEach(C=>{C.classes.forEach(p=>{if(p.class.professor===s){n++,i.add(C.dayName),d.add(p.class.name);const R=new Date("1970-01-01T"+p.class.start).getTime(),X=new Date("1970-01-01T"+p.class.end).getTime();m+=(X-R)/6e4}})}),l=n*a.classPay,this.coachInfo={fullName:a.fullName,classesNames:Array.from(d),days:Array.from(i).join(", "),totalClasses:n,totalTimeWorking:m,totalEarnings:l}}else console.log("Coach not found:",s)}sortClasses(s,a=""){return{...s,days:s.days.map(n=>({...n,classes:n.classes.filter(l=>l.class&&(!a||l.class.professor===a)).sort((l,i)=>{if(!(l.class&&i.class&&l.class.start&&i.class.start))return 0;const d=new Date("1970-01-01T"+l.class.start),m=new Date("1970-01-01T"+i.class.start);return d.getTime()-m.getTime()||l.class.mat.localeCompare(i.class.mat)})}))}}static#e=this.\u0275fac=function(a){return new(a||t)(e.Y36(f.u),e.Y36(S.K))};static#s=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-main-schedule"]],decls:8,vars:1,consts:[[1,"admin-container"],[1,"admin-top-menu"],[1,"admin-top-menu-logo"],["src","../../../../assets/img/legion-logo.png","alt",""],[1,"admin-top-menu-buttons"],["class","schedule-container","id","schedule",4,"ngIf"],["id","schedule",1,"schedule-container"],[1,"schedule-list"],["class","day-container",4,"ngFor","ngForOf"],["class","coach-info",4,"ngIf"],[1,"filter-section"],[3,"ngModel","ngModelChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"click"],[1,"day-container"],[1,"day-name"],["class","classes-list",4,"ngIf"],[1,"update-icon",3,"routerLink"],[1,"fa-solid","fa-pen-to-square"],[1,"classes-list"],["class","class-container",3,"ngClass",4,"ngFor","ngForOf"],[1,"class-container",3,"ngClass"],[1,"class-time"],[1,"fa-regular","fa-clock"],[1,"class-data"],[1,"coach-info"],[4,"ngFor","ngForOf"],[3,"value"]],template:function(a,n){1&a&&(e.TgZ(0,"section",0)(1,"section",1)(2,"div",2),e._UZ(3,"img",3),e.TgZ(4,"h2"),e._uU(5,"Flow305 Schedule"),e.qZA()(),e._UZ(6,"div",4),e.qZA(),e.YNc(7,D,11,4,"div",5),e.qZA()),2&a&&(e.xp6(7),e.Q6J("ngIf",n.weekSchedule))},dependencies:[u.mk,u.sg,u.O5,h.rH,r.YN,r.Kr,r.EJ,r.JJ,r.On]})}return t})(),I=(()=>{class t{static#e=this.\u0275fac=function(a){return new(a||t)};static#s=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-new-schedule"]],decls:2,vars:0,template:function(a,n){1&a&&(e.TgZ(0,"p"),e._uU(1,"new-schedule works!"),e.qZA())}})}return t})(),k=(()=>{class t{static#e=this.\u0275fac=function(a){return new(a||t)};static#s=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-user-schedule"]],decls:2,vars:0,template:function(a,n){1&a&&(e.TgZ(0,"p"),e._uU(1,"user-schedule works!"),e.qZA())}})}return t})();var J=o(1862),q=o(8398),E=o(7700),j=o(684);function P(t,c){if(1&t&&(e.TgZ(0,"div",6),e._UZ(1,"img",7),e.TgZ(2,"div")(3,"h2"),e._uU(4),e.qZA()()()),2&t){const s=e.oxw();e.xp6(4),e.hij("SCHEDULE FOR ",s.dayData.dayName,"")}}function Y(t,c){if(1&t){const s=e.EpF();e.TgZ(0,"li")(1,"div",16)(2,"div",17),e._uU(3),e.qZA(),e.TgZ(4,"div",18),e._uU(5),e.qZA(),e.TgZ(6,"div",18),e._uU(7),e.ALo(8,"truncateWords"),e.qZA(),e.TgZ(9,"div",19),e._uU(10),e.qZA(),e.TgZ(11,"div",19),e._uU(12),e.qZA(),e.TgZ(13,"div",19),e._uU(14),e.qZA(),e.TgZ(15,"div",20)(16,"button",21),e.NdJ("click",function(){const l=e.CHM(s).$implicit,i=e.oxw(2);return e.KtG(i.removeClassFromClassDay(null==l.class?null:l.class._id))}),e._UZ(17,"i",22),e.qZA()()()()}if(2&t){const s=c.$implicit,a=c.index,n=e.oxw(2);e.xp6(3),e.Oqu(15*(n.page-1)+a+1),e.xp6(2),e.Oqu(null==s.class?null:s.class.name),e.xp6(2),e.hij("Level: ",e.lcZ(8,7,null==s.class?null:s.class.programName),""),e.xp6(3),e.hij("Mat: ",null==s.class?null:s.class.mat,""),e.xp6(2),e.hij("C: ",null==s.class?null:s.class.professor,""),e.xp6(2),e.AsE("",null==s.class?null:s.class.start," - ",null==s.class?null:s.class.end,"")}}function Q(t,c){if(1&t&&(e.TgZ(0,"option",23),e._uU(1),e.qZA()),2&t){const s=c.$implicit;e.Q6J("value",s._id),e.xp6(1),e.HOy("",s.name," | Prof: ",s.professor," | Time: ",s.start," - ",s.end," ")}}function W(t,c){if(1&t){const s=e.EpF();e.TgZ(0,"div",8)(1,"ul",9),e.YNc(2,Y,18,9,"li",10),e.qZA(),e.TgZ(3,"div",11)(4,"select",12),e.NdJ("ngModelChange",function(n){e.CHM(s);const l=e.oxw();return e.KtG(l.selectedClassId=n)}),e.TgZ(5,"option",13),e._uU(6,"--Select Class"),e.qZA(),e.YNc(7,Q,2,5,"option",14),e.qZA(),e.TgZ(8,"button",15),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.addClassToDay())}),e._uU(9,"Add Class"),e.qZA()()()}if(2&t){const s=e.oxw();e.xp6(2),e.Q6J("ngForOf",s.dayData.classes),e.xp6(2),e.Q6J("ngModel",s.selectedClassId),e.xp6(3),e.Q6J("ngForOf",s.dbClasses)}}const B=[{path:"",component:b},{path:"new-schedule",component:I},{path:"user-schedule/:id",component:k},{path:"up-schedule/:day",component:(()=>{class t{constructor(s,a,n,l){this.route=s,this.scheduleService=a,this.classService=n,this.dialog=l,this.rightDay=null,this.classes=[],this.dbClasses=[],this.selectedClassId="",this.total=0,this.page=1}ngOnInit(){this.route.paramMap.subscribe(s=>{const a=s.get("day");this.rightDay=a,a&&(this.getWeekSchedule(a),this.getAllClasses())})}getWeekSchedule(s){this.scheduleService.getWeekSchedule().subscribe({next:a=>{this.weekSchedule=a,this.dayData=a.days.find(n=>n.day.split("T")[0]===s),this.classes=this.dayData?this.sortClasses(this.dayData.classes):[]},error:a=>console.error("Error loading week schedule",a)})}getAllClasses(){this.classService.getAllClasses().subscribe({next:s=>{this.dbClasses=s},error:s=>console.error("Error fetching classes",s)})}addClassToDay(){this.rightDay&&this.selectedClassId&&this.scheduleService.addClassToSchedule(this.selectedClassId,this.rightDay).subscribe({next:()=>{this.getWeekSchedule(this.rightDay),this.getAllClasses()},error:s=>console.error("Error adding class to schedule",s)})}sortClasses(s){return s.sort((a,n)=>{if(!a?.class?.start||!n?.class?.start)return 0;const l=new Date("1970-01-01T"+a.class.start),i=new Date("1970-01-01T"+n.class.start);return l.getTime()-i.getTime()||a.class.mat.localeCompare(n.class.mat)})}removeClassFromClassDay(s){this.dialog.open(J.$,{width:"300px"}).afterClosed().subscribe(n=>{if(n){const l=this.dayData.classes.filter(d=>d.class&&d.class._id!==s);if(!l.length)return void console.log("No classes updated, possibly an error with data structure.");this.scheduleService.updateDayInSchedule({weekStarting:this.weekSchedule.weekStarting,dayDate:this.rightDay,classes:l}).subscribe({next:()=>{console.log("Class removed successfully"),this.rightDay&&this.getWeekSchedule(this.rightDay)},error:d=>console.error("Error removing class from day",d)})}})}static#e=this.\u0275fac=function(a){return new(a||t)(e.Y36(h.gz),e.Y36(f.u),e.Y36(q.j),e.Y36(E.uw))};static#s=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-update-schedule"]],decls:9,vars:2,consts:[[1,"admin-container"],[1,"admin-top-menu"],["class","admin-top-menu-logo",4,"ngIf"],[1,"admin-top-menu-buttons"],["routerLink","/admin/dashboard/main-schedule",1,"button"],["class","table-container",4,"ngIf"],[1,"admin-top-menu-logo"],["src","../../../../assets/img/legion-logo.png","alt",""],[1,"table-container"],[1,"table-list"],[4,"ngFor","ngForOf"],[1,"class-selector"],[3,"ngModel","ngModelChange"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[3,"click"],[1,"item-box"],[1,"item-index-number","item-xsmall"],[1,"items","item-medium"],[1,"items","item-small"],[1,"items","item-xsmall"],["type","button",1,"button-remove",3,"click"],[1,"fa-solid","fa-xmark"],[3,"value"]],template:function(a,n){1&a&&(e.TgZ(0,"section",0)(1,"section",1),e.YNc(2,P,5,1,"div",2),e.TgZ(3,"div",3)(4,"button",4),e._uU(5,"back"),e.qZA()()(),e._UZ(6,"br")(7,"br"),e.YNc(8,W,10,3,"div",5),e.qZA()),2&a&&(e.xp6(2),e.Q6J("ngIf",n.dayData),e.xp6(6),e.Q6J("ngIf",n.dayData))},dependencies:[u.sg,u.O5,h.rH,r.YN,r.Kr,r.EJ,r.JJ,r.On,j.d],styles:[".class-selector[_ngcontent-%COMP%]{background-color:#232323;margin-top:20px;padding:30px;width:1040PX}.class-selector[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:90%;height:40px;padding-left:30px}.class-selector[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:20px}.button-remove[_ngcontent-%COMP%]{position:relative!important;width:28px!important;height:28px;background-color:#ee0c3d!important;margin:0!important}.item-xsmall[_ngcontent-%COMP%]{width:30px!important}.table-list[_ngcontent-%COMP%]   .item-medium[_ngcontent-%COMP%]{width:240px!important}"]})}return t})()}];let $=(()=>{class t{static#e=this.\u0275fac=function(a){return new(a||t)};static#s=this.\u0275mod=e.oAB({type:t});static#t=this.\u0275inj=e.cJS({imports:[h.Bz.forChild(B),h.Bz]})}return t})();var H=o(6472),K=o(682);let L=(()=>{class t{static#e=this.\u0275fac=function(a){return new(a||t)};static#s=this.\u0275mod=e.oAB({type:t});static#t=this.\u0275inj=e.cJS({imports:[u.ez,$,h.Bz,r.UX,r.u5,H.JX,v.c,Z.lN,_.LD,T.p9,x.Fk,K.G]})}return t})()}}]);